import os
import discord
from discord.ext import commands
from datetime import datetime

# ================= CONFIG =================
TOKEN = os.environ["DISCORD_TOKEN"]  # ‡πÉ‡∏™‡πà TOKEN ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô ENV
TARGET_CHANNEL_ID = 123456789012345678  # ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö)
ADMIN_CHANNEL_ID = 123456789012345678   # ‡∏´‡πâ‡∏≠‡∏á log ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
GUIDE_CHANNEL_ID = 1406537337676103742   # ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏ó‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠

# ================= BOT SETUP =================
intents = discord.Intents.default()
intents.members = True
bot = commands.Bot(command_prefix="!", intents=intents)

# ================= ‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å Command =================
@bot.tree.command(name="‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å", description="‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô")
async def send_message(interaction: discord.Interaction,
                       user: discord.Member,
                       message: str,
                       reveal: str):
    await interaction.response.defer(ephemeral=True)

    guild = interaction.guild
    target_channel = guild.get_channel(TARGET_CHANNEL_ID)
    admin_channel = guild.get_channel(ADMIN_CHANNEL_ID)

    # ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å
    public_content = f"**‡∏ñ‡∏∂‡∏á {user.mention}**\n{message}"

    # ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å
    await target_channel.send(public_content)

    # ‡∏™‡πà‡∏á DM ‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
    try:
        sender_name = interaction.user.display_name if reveal.strip().lower() == "‡πÉ‡∏ä‡πà" else "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡∏±‡∏ß‡∏ï‡∏ô"
        await user.send(f"‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å {sender_name}:\n\n{message}")
    except:
        pass

    # Log ‡πÑ‡∏õ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    now = datetime.now().strftime("%d/%m/%Y ‡πÄ‡∏ß‡∏•‡∏≤ %H:%M")
    embed = discord.Embed(title="üì© ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà", color=0x1ABC9C)
    embed.add_field(
        name="‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á",
        value=f"{interaction.user.mention} ({'‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢' if reveal.strip().lower() == '‡πÉ‡∏ä‡πà' else '‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢'})",
        inline=False
    )
    embed.add_field(name="‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö", value=f"{user.mention} ({user.id})", inline=False)
    embed.add_field(name="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", value=message, inline=False)
    embed.set_footer(text=f"üìÖ {now}")
    await admin_channel.send(embed=embed)

    # ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    await interaction.followup.send("‚úÖ ‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß", ephemeral=True)

# ================= Bot Events =================
@bot.event
async def on_ready():
    await bot.tree.sync()
    print(f"‚úÖ Logged in as {bot.user}")

    guide_channel = bot.get_channel(GUIDE_CHANNEL_ID)
    if guide_channel:
        embed = discord.Embed(
            title="üìå ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å",
            description="‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡πÉ‡∏Ñ‡∏£ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:\n\n"
                        "`/‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å user:@‡∏ä‡∏∑‡πà‡∏≠ message:‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° reveal:‡πÉ‡∏ä‡πà/‡πÑ‡∏°‡πà`\n\n"
                        "üîπ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: `/‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å @Jojo ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πà‡∏≠‡∏¢ reveal:‡πÑ‡∏°‡πà`",
            color=0x5865F2
        )
        embed.set_footer(text="‡∏£‡∏∞‡∏ö‡∏ö‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥")
        await guide_channel.send(embed=embed)

# ================= Run Bot =================
bot.run(TOKEN)
